<?php

/**
 * @file
 * File: media_album_av.install
 *
 *
 */

use Drupal\node\Entity\NodeType;
use Drupal\field\Entity\FieldStorageConfig;
use Drupal\field\Entity\FieldConfig;
use Drupal\Core\Entity\Entity\EntityFormDisplay;
use Drupal\Core\Entity\Entity\EntityViewDisplay;
use Drupal\media\Entity\MediaType;
use Drupal\taxonomy\Entity\Vocabulary;



/**
 * Implements hook_install().
 */
function media_album_av_install() {
  // Désactiver filefield_paths pour les entités créées si le module existe et est actif
  if (\Drupal::moduleHandler()->moduleExists('filefield_paths')) {
    // Désactiver filefield_paths pour les champs de photo et vidéo
    $field_configs = [
      'media.media_album_av_photo.field_media_album_av_photo',
      'media.media_album_av_video.field_media_album_av_video',
    ];

    foreach ($field_configs as $field_config_id) {
      $field_config = \Drupal\field\Entity\FieldConfig::load($field_config_id);
      if ($field_config) {
        // Vérifier si l'attribut enabled est présent et le passer à false
        $filefield_paths_settings = $field_config->getThirdPartySetting('filefield_paths', 'enabled');
        if ($filefield_paths_settings !== NULL) {
          $field_config->setThirdPartySetting('filefield_paths', 'enabled', false);
          $field_config->save();
          \Drupal::messenger()->addStatus(t('Filefield Paths disabled for @field_id', ['@field_id' => $field_config_id]));
        }
      }
    }
  }
}

/**
 * Implements hook_uninstall().
 */
function media_album_av_uninstall() {
  // Optional cleanup when uninstalling
  // Warning: this will delete all data!
$delete=false;

/*
  $delete=true;
  // Delete the content type
  $content_type = NodeType::load('media_album_av');
  if ($content_type) {
    $content_type->delete();
  }

  // Delete the media types
  $media_photo = MediaType::load('media_album_av_photo');
  if ($media_photo) {
    $media_photo->delete();
  }

  $media_video = MediaType::load('media_album_av_video');
  if ($media_video) {
    $media_video->delete();
  }

  // Delete the vocabulary
  $vocab = Vocabulary::load('media_album_av_authors');
  if ($vocab) {
    $vocab->delete();
  }
  $vocab = Vocabulary::load('media_album_av_category');
  if ($vocab) {
    $vocab->delete();
  }
  $vocab = Vocabulary::load('media_album_av_event');
  if ($vocab) {
    $vocab->delete();
  }
  $vocab = Vocabulary::load('media_album_av_folders');
  if ($vocab) {
    $vocab->delete();
  }
*/

  if ($delete) {
      \Drupal::messenger()->addStatus(t('Module uninstalled. Created content is DELETED.'));
  }
  else {
  \Drupal::messenger()->addStatus(t('Module uninstalled. Created content is preserved.'));
  }
}
